<script>
  const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwTE4fgbIuhUwIzCR2KRqRGaaUYJyhYx0YflWC0TmF9b5Hkx7t5ZR_QPWM755HljBoN2A/exec';

  // Собираем GET-параметры как объект
  const urlParams = Object.fromEntries(new URLSearchParams(window.location.search));

  // Отправка данных при загрузке
  fetch(SCRIPT_URL, {
    method: 'POST',
    mode: 'no-cors',
    headers: { 'Content-Type': 'application/json; charset=utf-8' },
    body: JSON.stringify({
      message: "[СТРАНИЦА ОТКРЫТА]",
      queryParams: urlParams
    })
  }).catch(() => {});

  // Отправка при отправке формы
  document.getElementById('anonForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const message = e.target.message.value.trim();
    if (!message) return;

    const btn = e.target.querySelector('button');
    const statusEl = document.getElementById('status');
    btn.disabled = true;
    statusEl.textContent = 'Отправка...';

    try {
      await fetch(SCRIPT_URL, {
        method: 'POST',
        mode: 'no-cors',
        headers: { 'Content-Type': 'application/json; charset=utf-8' },
        body: JSON.stringify({
          message: message,
          queryParams: urlParams
        })
      });
      statusEl.textContent = '✅ Отправлено!';
      e.target.reset();
    } catch {
      statusEl.textContent = '❌ Ошибка.';
    } finally {
      btn.disabled = false;
    }
  });
</script>
