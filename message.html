<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ê–Ω–æ–Ω–∏–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
body {
  font-family: sans-serif;
  width: 100%;
  padding: 16px; /* –º–æ–∂–Ω–æ —É–º–µ–Ω—å—à–∏—Ç—å –¥–æ 8px –∏–ª–∏ 0, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ */
  background: #fff;
  margin: 0;
}
    h2 {
      font-size: 18px;
      margin-bottom: 12px;
    }
    textarea {
      width: 100%;
      height: 90px;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 4px;
      resize: vertical;
    }
    button {
      padding: 8px 16px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:disabled {
      background: #cccccc;
    }
    #status {
      margin-top: 10px;
      font-size: 14px;
      min-height: 18px;
    }
  </style>
</head>
<body>
  <h2>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–Ω–æ–Ω–∏–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</h2>
  <form id="anonForm">
    <textarea name="message" placeholder="–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." required></textarea><br>
    <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </form>
  <p id="status"></p>

  <script>
  const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwTE4fgbIuhUwIzCR2KRqRGaaUYJyhYx0YflWC0TmF9b5Hkx7t5ZR_QPWM755HljBoN2A/exec';

  // –°–æ–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL
  const urlParams = Object.fromEntries(new URLSearchParams(window.location.search));

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è payload (—á—Ç–æ–±—ã –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É)
  function createPayload(extraFields = {}) {
    const payload = new URLSearchParams();

    // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ –ø–æ–ª—è
    payload.append('message', extraFields.message || 'Open form');
    payload.append('referrer', document.referrer);
    payload.append('userAgent', navigator.userAgent);

    // –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL
    for (const [key, value] of Object.entries(urlParams)) {
      payload.append(key, value);
    }

    return payload;
  }

  // üîπ –õ–æ–≥ –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–æ—Ä–º—ã (–ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ)
  fetch(SCRIPT_URL, {
    method: 'POST',
    body: createPayload()
  }).catch(() => {});

  // üîπ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
  document.getElementById('anonForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const msg = e.target.message.value.trim();
    if (!msg) return;

    const btn = e.target.querySelector('button');
    const status = document.getElementById('status');
    btn.disabled = true;
    status.textContent = '–û—Ç–ø—Ä–∞–≤–∫–∞...';

    try {
      await fetch(SCRIPT_URL, {
        method: 'POST',
        body: createPayload({ message: msg }) // –ø–æ–¥–º–µ–Ω—è–µ–º message
      });
      status.textContent = '‚úÖ –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!';
      e.target.reset();
    } catch {
      status.textContent = '‚ùå –û—à–∏–±–∫–∞';
    } finally {
      btn.disabled = false;
    }
  });
</script>
</body>
</html>
